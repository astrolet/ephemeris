#!/usr/bin/env bash

VERSION="2.01.00-01"
DIRNAME="$(pwd)/$(DIRNAME "$0")"
JAVASRC="${DIRNAME}/../src/java"

# http://stackoverflow.com/questions/192249/
for i in "$@"; do
  case $i in
    -v|--verbose)
    VERBOSE=YES
    shift
    ;;
    -f|--force)
    FORCE=YES
    shift
    ;;
    *)
    # options for Precompile ...
    ;;
  esac
done

vecho() {
  if [[ $VERBOSE == "YES" ]]; then
    echo "$1"
  fi
}

vecho "precompile step"

if [[ ! -d "${JAVASRC}/ephemeris/swisseph" || $FORCE == "YES" ]]; then
  pushd "${JAVASRC}/swisseph-${VERSION}"
  echo "precompiling ..."
  javac Precompile.java
  java Precompile -qfc -iswesrc -iprogs -DTRANSITS
  mkdir -p "${JAVASRC}/ephemeris" # this is in the repo thanks to README.md
  rm -rf "${JAVASRC}/ephemeris/swisseph"
  cp -r swisseph "${JAVASRC}/ephemeris/swisseph"
  popd
  vecho "precompile done"
else
  vecho "swisseph already exists"
  vecho "skipping precompilation"
fi
