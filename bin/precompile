#!/bin/bash

VERSION="2.01.00-01"

# http://stackoverflow.com/questions/192249/
for i in "$@"; do
  case $i in
    -v|--verbose)
    VERBOSE=YES
    shift
    ;;
    -f|--force)
    FORCE=YES
    shift
    ;;
    *)
    # options for Precompile ...
    ;;
  esac
done

vecho() {
  if [[ $VERBOSE == "YES" ]]; then
    echo "$1"
  fi
}

vecho "precompile step"

if [[ ! -d "src/java/ephemeris/swisseph" || $FORCE == "YES" ]]; then
  pushd "src/java/swisseph-${VERSION}"
  echo "precompiling ..."
  javac Precompile.java
  java Precompile -qfc -iswesrc -iprogs -DTRANSITS
  mkdir -p ../ephemeris
  rm -rf ../ephemeris/swisseph
  cp -r swisseph ../ephemeris/swisseph
  popd
  vecho "precompile done"
else
  vecho "swisseph already exists"
  vecho "skipping precompilation"
fi
